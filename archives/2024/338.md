---
title: Node.js 环境变量
number: '#338'
link: 'https://github.com/toFrankie/blog/issues/338'
created_at: '2024-05-02 02:00:16'
updated_at: '2024-05-19 01:17:34'
labels:
  - Node.js
  - 前端
  - '2024'
---
## 前言

在 Node.js 中通常会使用 `process.env` 来获取某个环境变量。

> [process.env](https://nodejs.org/docs/v20.12.1/api/process.html#processenv)

它返回一个包含用户环境的对象。

我们知道，在 package.json 里定义的 NPM Script 都是 Shell 命令。这里的用户环境是 Shell 进程，这个对象包含了当前进程的 Shell 变量。注意，`process.env` 对象可以被修改，但其修改不会影响到此 Node.js 进程之外。

## Shell 变量

Shell 变量可分为「环境变量」和「自定义变量」。

- 环境变量：通常是指 Shell 内置变量或者 Shell 配置文件中声明的变量。
- 自定义变量：通常是在 Shell 脚本或命令行中声明的变量，默认仅当前进程可访问。使用 `export` 命令声明的变量，其子进程也可访问。

作用域：

- 环境变量：创建 Shell 进程时会自动加载，可以被当前进程以及子进程访问。
- 自定义变量：
    - 函数体内：在函数体内使用 `local` 显式声明的变量，其作用域仅在函数内。
    - 当前进程：当前 Shell 进程内可访问，但子进程不能访问。
    - 当前进程及子进程：使用 `export` 显式声明的变量，其作用域是当前进程及子进程。 


```shell
function fn() {
  foo=1         # 作用域为当前进程
  local bar=2   # 作用域为当前函数
  export baz=3  # 作用域为当前进程及子进程
}

fn

echo $foo    # 1
echo $bar    # 空字符串
echo $baz    # 3
```

## NODE_ENV 是什么？

按环境区分 API、跨端构建工具的条件编译等都是很常见的应用场景。

那么，

- `NODE_ENV` 是什么？
- `NODE_ENV` 从哪里来？
- `NODE_ENV` 如何定义？

> [process.env](https://nodejs.org/docs/v20.12.1/api/process.html#processenv)

> `NODE_ENV` 只是 `process.env` 里一个算是约定俗成的变量罢了，常用于区分开发/生产模式。有点像 git remote 里的 origin 那味道。

`process.env` 返回一个包含用户环境的对象。换句话说，它里面包含了当前 Shell 进程的变量，所以 `process.env.PATH` 和 `echo $PATH` 的结果是一样的。

但反过来，新增/修改了 `process.env` 某个属性的值不会影响到 Shell 进程内的变量。比如，在 Node 脚本内设置 `process.env.FOO` 的值，但 `echo $FOO` 并没有得到值 `BAR`。

```shell
$ node -e 'process.env.FOO = "BAR"; console.log(process.env.FOO)' && echo $FOO
BAR


```

> 在 Shell 中，如果引用的变量不存在，它不会报错，而是输出空字符。


### Shell 变量

在 Shell 里，使用 `env` 命令可以查看当前进程的变量。

```ini
USER=frankie
SHELL=/bin/zsh
HOME=/Users/frankie
_=/usr/bin/env
```

这些在 Node 脚本中可以通过 `process.env` 获取到。

```js
{
  USER: 'frankie',
  SHELL: '/bin/zsh',
  HOME: '/Users/frankie',
  _: '/Users/frankie/.nvm/versions/node/v18.16.1/bin/node'
}
```



未完待续...
