---
title: Node.js 环境变量
number: '#338'
link: 'https://github.com/toFrankie/blog/issues/338'
created_at: '2024-05-02 02:00:16'
updated_at: '2024-05-04 02:35:54'
labels:
  - Node.js
  - 前端
  - '2024'
---
## 前言

在前端工程项目中，将环境变量应用在项目打包或业务代码中是很常见的做法。

比如，仅在开发模式下记录日志：

```js
if (process.env.NODE_ENV === 'development') {
  log.info('something...')
}
```

构建工具在编译时从 Node 环境中获取 `process.env.NODE_ENV` 的值并替换，变成这样：

```js
// 开发模式
if ('development' === 'development') {
  log.info('something...')
}

// 生产模式
if ('production' === 'development') {
  log.info('something...')
}
```

经过压缩处理可能会变成这样：

```js
// 开发模式
if (true) {
  log.info('something...')
}

// 生产模式
if (false) {
  log.info('something...')
}
```

也可能是这样：

```js
// 开发模式
log.info('something...')

// 生产模式
// dead code 直接移除...
```

按环境区分 API、跨端构建工具的条件编译等都是很常见的应用场景。

那么，

- `NODE_ENV` 是什么？
- `NODE_ENV` 从哪里来？
- `NODE_ENV` 如何定义？

## NODE_ENV 是什么？

> `NODE_ENV` 只是 `process.env` 里一个算是约定俗成的变量罢了，常用于区分开发/生产模式。

[process.env](https://nodejs.org/docs/v20.12.1/api/process.html#processenv) 返回一个包含用户环境的对象。换句话说，`process.env` 里面包含了当前 Shell 进程的变量，所以 `process.env.PATH` 和 `echo $PATH` 的结果是一样的。

但反过来，新增/修改了 `process.env` 某个属性的值，不会影响到 Shell 进程内的变量。比如，在 Node 脚本内设置 `process.env.FOO` 的值，但 `echo $FOO` 并没有得到值 `BAR`。

```shell
$ node -e 'process.env.FOO = "BAR"; console.log(process.env.FOO)' && echo $FOO
BAR

```

> 在 Shell 中，如果引用的变量不存在，它不会报错，而是输出空字符。


### Shell 变量

在 Shell 里，使用 `env` 命令可以查看当前进程的变量。

```ini
USER=frankie
SHELL=/bin/zsh
HOME=/Users/frankie
_=/usr/bin/env
```

这些在 Node 脚本中可以通过 `process.env` 获取到。

```js
{
  USER: 'frankie',
  SHELL: '/bin/zsh',
  HOME: '/Users/frankie',
  _: '/Users/frankie/.nvm/versions/node/v18.16.1/bin/node'
}
```



未完待续...
